[**Polyhedral splines**](https://github.com/UF-CISE-Surflab/blender-polyhedral-splines) is a [Blender](https://www.blender.org/) [add-on](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html) that converts quad-dominant meshes into B-spline patches.
This enables artists to edit spline surfaces in real-time via the existing polyhedral modeling capabilities of Blender.

Please find detailed introduction [here](https://uf-cise-surflab.github.io/blender-polyhedral-splines-web/)!

# Features
1. Smooth surfaces without subdividing the mesh. (The Blender's default [subdivision](https://docs.blender.org/manual/en/latest/modeling/modifiers/generate/subdivision_surface.html) and [smooth](https://docs.blender.org/manual/en/latest/modeling/modifiers/deform/smooth.html) operator exponentially increase the number of vertices. This can cause high computational and storage overhead for downstream operations)
2. Easy, exact computation of moments, e.g. volume, center of mass, axes of inertia, ...
3. Preserves the polyhedral character of the input (Low-degree splines generalize bi-2, bi-quadratic, splines. Bi-2 splines are by default less smooth than bi-3 splines, and curvature changes more sharply.)

<p float="left">
    <img src="img_readme/tricube_polyhedral_splines.png" width="300" />
    <img src="img_readme/tricube_catmull_clark.png" width="300" />
</p>

# Installation
1. Download [Polyhedral splines repo](https://github.com/UF-CISE-Surflab/blender-polyhedral-splines/) as add-on .zip file
2. Follow [official add-on installation guide](https://docs.blender.org/manual/en/latest/editors/preferences/addons.html).

# How to find the installed add-on in Blender?
Click on the small left angle bracket to expand the panel

![Alt text](img_readme/find_addon_panel_1.png)

Then switch to the tab of Polyhedral Splines

![Alt text](img_readme/find_addon_panel_2.png)

&nbsp;&nbsp;

# How to use it?

> The add-on supports only a single object in the scene.

> The add-on does not support highlight lines in Blender, because Blender does not correctly evaluate derivatives of splines along boundaries.  Export in the add-on provided .igs format to an outside iges renderer.

## Mesh inspection
Select the mesh object and click "Inspect mesh" to highlight the connectivity not supported by our algorithm.

<p float="left">
  <img src="img_readme/unsupport-highlight-0.png" width="300" />
  <img src="img_readme/unsupport-highlight-1.png" width="325" />
</p>

> If fixing connectivity is tricky: one step of Catmull-Clark subdivision always yields a supported configuration

> The single subdivision step will be applied automatically if any unsupported configuration is detected.

&nbsp;

## B-spline patch generaton
Select the mesh object and click "Generate Bspline Patches" to generate multiple patch objects.

> This may take a few seconds for a larger mesh due to Blender's structure creation overhead.

> Please make sure axis of import mesh is Y-forward & Z-up. Otherwise patches are not aligned with the mesh.

<p float="left">
  <img src="img_readme/monkey_mesh.png" width="320" />
  <img src="img_readme/monkey_ssp.png" width="324" />
</p>

&nbsp;

## Interactive modeling
Now the user can drag the control points to edit the shape in real-time.

<p float="left">
  <img src="img_readme/modeling_before.png" width="325" />
  <img src="img_readme/modeling_after.png" width="305" />
</p>

&nbsp;

### Show / Hide boundary of patches
Expand "Viewport Shading" and (dis)select "Outline".

<p float="left">
  <img src="img_readme/outline.png" width="138" />
  <img src="img_readme/outline_on.png" width="290" />
  <img src="img_readme/outline_off.png" width="300" />
</p>

&nbsp;

### Show / Hide faces of control polygon
Click on "View" then "Toggle Mesh Faces" to hide/show the semi-transparent control polyhedron ( = input polyhedron).

<p float="left">
  <img src="img_readme/toggle.png" width="140" />
  <img src="img_readme/show_face.png" width="295" />
  <img src="img_readme/hide_face.png" width="295" />
</p>

&nbsp;

### Hide patch objects
Filter out the patch objects and keep the control polygon in the scene collection list. (This does not affect the display.)

<p float="left">
  <img src="img_readme/filter_object_panel.png" width="130" />
  <img src="img_readme/filter_object_off.png" width="300" />
  <img src="img_readme/filter_object_on.png" width="300" />
</p>

&nbsp;

## Patch coloring
Set color for patches generated by different configurations.

<p float="left">
  <img src="img_readme/coloring_panel.png" width="340" />
  <img src="img_readme/coloring_1.png" width="310" />
</p>

&nbsp;

## Export IGS File

<p float="left">
  <img src="img_readme/export_igs.png" width="400" />
</p>

&nbsp;&nbsp;

# Implemented algorithms

1. Karčiauskas, K., & Peters, J. (2015). Smooth multi-sided blending of biquadratic splines. *Computers & Graphics*, 46, 172-185.
2. Karčiauskas, K., & Peters, J. (2020). Smooth polar caps for locally quad-dominant meshes. *Computer Aided Geometric Design*, 81, 101908.
3. Karčiauskas, K., & Peters, J. (2020). Low degree splines for locally quad-dominant meshes. *Computer Aided Geometric Design*, 83, 101934.
